<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assignments - Learning Management System</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-[#0b1447] bg-cover bg-center text-[#151926] relative"
  style="background-image: url('https://upload.wikimedia.org/wikipedia/commons/3/37/IPB_campus_building_2012.jpg');">

  <!-- Blur dark overlay -->
  <div class="absolute inset-0 bg-[#0b1447bf] backdrop-blur-md -z-10"></div>

  <!-- Dashboard container -->
  <div
    class="max-w-[1200px] mx-auto my-10 bg-[#f8faff] min-h-[700px] rounded-2xl shadow-[0_5px_25px_rgba(0,0,0,0.3)] flex overflow-hidden">

    <!-- SIDEBAR -->
    <aside
      class="w-[280px] bg-gradient-to-b from-[#3c8aba] to-[#33a6c6] text-[#04203a] p-8 flex flex-col items-center shadow-[inset_-5px_0_15px_rgba(0,0,0,0.25)]">
      <h2 class="font-bold text-[22px] mb-8 select-none text-center">Student Module</h2>

      <ul class="w-full space-y-6 font-semibold text-center">
        <li class="rounded-lg px-4 py-2 hover:bg-white cursor-pointer"><a href="dashboard.html">Dashboard</a></li>
        <li class="rounded-lg px-4 py-2 hover:bg-white cursor-pointer"><a href="courses.html">Courses</a></li>
        <li class="rounded-lg px-4 py-2 bg-[#d2d6e1] cursor-pointer"><a>Assignments</a></li>
        <li class="rounded-lg px-4 py-2 hover:bg-white cursor-pointer"><a href="quizz.html">Quizzes</a></li>
        <li class="rounded-lg px-4 py-2 hover:bg-white cursor-pointer"><a href="performance.html">Performance Reports</a></li>
        <li class="rounded-lg px-4 py-2 hover:bg-white cursor-pointer"><a href="notification.html">Notifications</a></li>
      </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-10 overflow-y-auto">
      <!-- Header -->
      <header class="flex justify-between items-center mb-6">
        <h1 class="text-[28px] font-bold select-none" id="assignmentsTitle">Computer Science Assignments</h1>
        <div class="font-semibold text-[#6b7280] text-[16px]" id="studentId">Student ID: ...</div>
      </header>

      <!-- Assignments List -->
      <div id="assignmentsList" class="flex flex-col gap-5"></div>
    </main>
  </div>

  <!-- ðŸ”¥ JWT + ASSIGNMENTS FETCH SCRIPT -->
  <script>
    const token = localStorage.getItem("access_token");
    if (!token) window.location.href = "login.html";

    // Load Student Details
    async function loadStudent() {
      try {
        const res = await fetch("http://127.0.0.1:8000/api/students/", {
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        const student = data[0];

        document.getElementById("studentId").innerText = "Student ID: " + student.admission_no;
      } catch (err) {
        console.log("Student load error:", err);
      }
    }

    // Status badge class color
    function getStatusClass(status) {
      const s = status.toLowerCase();
      if (s === "submitted") return "bg-emerald-100 text-emerald-700";
      if (s === "pending") return "bg-amber-100 text-amber-700";
      if (s === "overdue") return "bg-red-100 text-red-700";
      return "bg-gray-200 text-gray-700";
    }

    // Load Assignments
    async function loadAssignments() {
      try {
        const res = await fetch("https://lms-student-module-backend-production.up.railway.app/api/assignments/", {
          headers: { Authorization: `Bearer ${token}` }
        });
        const assignments = await res.json();

        let html = "";
        assignments.forEach(asg => {
          html += `
            <article class="bg-white rounded-2xl shadow-[0_6px_16px_rgba(0,0,0,0.12)] p-6 flex justify-between items-center gap-5 transition hover:-translate-y-1 hover:shadow-[0_12px_30px_rgba(0,0,0,0.18)] cursor-pointer">
              <div class="flex-1">
                <div class="text-[20px] font-bold text-[#2563eb] mb-1">${asg.title}</div>
                <div class="text-[14px] text-[#374151] mb-2">${asg.description}</div>
                <div class="text-[13px] text-[#6b7280]">
                  <span class="mr-4">Course: ${asg.course}</span>
                  <span>Due: ${asg.due_date}</span>
                </div>
              </div>

              <div class="flex flex-col items-end gap-2">
                <div class="status px-4 py-1 rounded-full text-[14px] font-semibold ${getStatusClass(asg.status)}">
                  ${asg.status}
                </div>

                ${
                  asg.status.toLowerCase() === "submitted"
                    ? `<button class="bg-gray-400 text-white px-4 py-2 rounded-lg font-semibold cursor-not-allowed">Upload</button>`
                    : `<button class="bg-[#2563eb] hover:bg-[#1d4ed8] text-white px-4 py-2 rounded-lg font-semibold"
                         onclick="uploadAssignment('${asg.id}')">Upload</button>`
                }
              </div>
            </article>
          `;
        });

        document.getElementById("assignmentsList").innerHTML = html;
      } catch (err) {
        console.log("Assignments load error:", err);
      }
    }

    // Upload button function
    function uploadAssignment(id) {
      alert("Upload Assignment (ID: " + id + ") â€“ yahan file upload popup / UI open hoga.");
    }

    loadStudent();
    loadAssignments();
  </script>

</body>
</html>
